<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>India CSR Spending Dashboard - FY 2023-24 (Complete Dataset)</title>
    <link rel="stylesheet" href="style.css">
    <!-- Chart.js and datalabels plugin -->
    <script src="map-enhancements.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div id="mainDashboard" class="dashboard-container" style="display: none;">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="container">
                <h1>India CSR Spending Dashboard</h1>
                <p class="subtitle">FY 2023-24</p>
                <div class="dataset-stats">
                    <span class="stat-badge" id="totalCompaniesHeader">Loading...</span>
                    <span class="stat-badge" id="totalStatesHeader">43 States/Union Territories</span>
                    <span class="stat-badge" id="totalProjectsHeader">Loading...</span>
                    <span class="stat-badge" id="totalSpendingHeader">Loading...</span>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="dashboard-nav">
            <div class="container">
                <div class="nav-tabs">
                    <button class="tab-button active" data-tab="overview">Overview</button>
                    <button class="tab-button" data-tab="map">India Map</button>
                    <button class="tab-button" data-tab="states">State Analysis</button>
                    <button class="tab-button" data-tab="sectors">Sector Analysis</button>
                    <button class="tab-button" data-tab="companies">Companies</button>
                </div>
            </div>
        </nav>

        <!-- Filters Panel -->
        <div class="filters-panel">
            <div class="container">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="form-label">States (Multi-select)</label>
                        <select id="stateFilter" class="form-control" multiple size="3">
                            <option value="">Loading states...</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label">Sectors (Multi-select)</label>
                        <select id="sectorFilter" class="form-control" multiple size="3">
                            <option value="">Loading sectors...</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label">PSU Type (Multi-select)</label>
                        <select id="psuFilter" class="form-control" multiple size="3">
                            <option value="PSU">PSU</option>
                            <option value="Non-PSU">Non-PSU</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label">Company Search</label>
                        <input type="text" id="companySearch" class="form-control" placeholder="Search companies...">
                    </div>
                    <div class="filter-actions">
                        <button id="resetFilters" class="btn btn--secondary">Reset Filters</button>
                        <button id="exportFilteredData" class="btn btn--primary">Export Filtered XLSX</button>
                    </div>
                </div>
                <div class="filter-results">
                    <span id="filterResults" class="filter-status">Loading complete dataset...</span>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading-overlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p>Loading complete CSR dataset from Google Sheets...</p>
            </div>
        </div>

        <!-- Main Content -->
        <main class="dashboard-main">
            <div class="container">
                
                <!-- Overview Tab -->
                <div id="overview" class="tab-content active">
                    <!-- Key Metrics Cards -->
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-icon">‚Çπ</div>
                            <div class="metric-content">
                                <h3 class="metric-value" id="totalSpendingMetric">Loading...</h3>
                                <p class="metric-label">Total CSR Spending</p>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">üè¢</div>
                            <div class="metric-content">
                                <h3 class="metric-value" id="totalCompaniesMetric">Loading...</h3>
                                <p class="metric-label">Total Companies</p>
                                <small>From complete dataset</small>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div the metric-icon">üìã</div>
                            <div class="metric-content">
                                <h3 class="metric-value" id="totalProjectsMetric">Loading...</h3>
                                <p class="metric-label">Total Projects</p>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">üìä</div>
                            <div class="metric-content">
                                <h3 class="metric-value" id="avgPerProjectMetric">Loading...</h3>
                                <p class="metric-label">Average per Project</p>
                            </div>
                        </div>
                    </div>

                    <!-- Company Distribution Analysis -->
                    <div class="section-grid">
                        <div class="chart-section">
                            <div class="chart-header">
                               <!-- <h3>Top 15 States by CSR Spending</h3> -->
                                <button class="chart-download-btn" data-chart="overviewStates">üì• Download PNG</button>
                            </div>
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="overviewStatesChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-section">
                            <div class="chart-header">
                                <!-- <h3>Top Development Sectors</h3> -->
                                <button class="chart-download-btn" data-chart="overviewSectors">üì• Download PNG</button>
                            </div>
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="overviewSectorsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- India Map Tab -->
                <div id="map" class="tab-content">
                    <!--
                        <div class="data-header">
                        <h2>India CSR Spending Map</h2>
                        <p class="data-description">Interactive map showing CSR spending by state with complete dataset</p>
                    </div>
                    -->
                    
<section class="map-section">
  <div class="chart-header">
    <div>
      <h3 class="chart-title" id="mapTitle">CSR Spending by States/UTs in India</h3>
      <p class="chart-subtitle" id="mapSubtitle">Interactive visualization showing CSR expenditure across Indian states and union territories</p>
    </div>
    <div class="map-export-controls">
      <button class="map-export-btn" id="exportMapSvg" aria-label="Export map as SVG">
        üìä Export SVG
      </button>
      <button class="map-export-btn" id="exportMapPng" aria-label="Export map as PNG">
        üñºÔ∏è Export PNG
      </button>
    </div>
  </div>
  
  <!-- Applied filters display -->
  <div class="applied-filters-section" id="appliedFiltersMap">
    <h4 class="applied-filters-title">Applied Filters:</h4>
    <ul class="applied-filters-list" id="appliedFiltersList">
      <li class="no-filters-text">No filters applied</li>
    </ul>
  </div>
  
  <div class="map-container">
    <div id="indiaMap"></div>
    
    <!-- Preserved your existing tooltip structure -->
    <div id="mapTooltip" class="map-tooltip">
      <div class="tooltip-content">
        <strong id="tooltipState">State</strong><br>
        <span id="tooltipSpending">Spending: ‚Çπ0 Cr</span><br>
        <span id="tooltipProjects">Projects: 0</span><br>
        <span id="tooltipCompanies">Companies: 0</span>
      </div>
    </div>
    
    <!-- Watermark -->
    <div class="map-watermark">¬© Your Organization Name</div>
  </div>
</section>

                <!-- States Tab -->
                <div id="states" class="tab-content">
                    <!--
                    <div class="data-header">
                        <h2>Complete State Analysis - All States</h2>
                        <p class="data-description">Comprehensive analysis of CSR spending across all states from complete dataset</p>
                    </div>
                    -->
                    <div class="section-grid">
                        <div class="chart-section full-width">
                            <div class="chart-header">
                            <!--    <h3>CSR Spending in Selected States/ UTs</h3> -->
                                <button class="chart-download-btn" data-chart="states">üì• Download PNG</button>
                            </div>
                            <div class="chart-container" style="position: relative; height: 400px;">
                                <canvas id="statesChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-section">
                        <div class="table-header">
                            <!--  <h3>All States - Complete Data</h3> -->
                            <div class="table-controls">
                                <span id="statesCount" class="data-count">Loading...</span>
                                <button id="exportStatesData" class="btn btn--outline btn--sm">Export States XLSX</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table id="statesTable" class="data-table">
                                <thead>
                                    <tr>
                                        <th data-sort="state">State/Region</th>
                                        <th data-sort="spending">Total Spending (‚Çπ Cr)</th>
                                        <th data-sort="projects">Number of Projects</th>
                                        <th data-sort="companies">Number of Companies</th>
                                        <th data-sort="average">Avg per Project (‚Çπ Cr)</th>
                                        <th data-sort="percentage">% of Total</th>
                                    </tr>
                                </thead>
                                <tbody id="statesTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sectors Tab -->
                <div id="sectors" class="tab-content">
                   <!-- 
                    <div class="data-header">
                        <h2>Development Sectors Analysis</h2> 
                        <p class="data-description">Complete breakdown of CSR investments across all development sectors</p>
                    </div>
                    -->
                    <div class="section-grid">
                        <div class="chart-section full-width">
                            <div class="chart-header">
                               <!-- <h3>All Development Sectors</h3> -->
                                <button class="chart-download-btn" data-chart="sectors">üì• Download PNG</button>
                            </div>
                            <div class="chart-container" style="position: relative; height: 400px;">
                                <canvas id="sectorsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-section">
                        <div class="table-header">
                            <h3>Sector-wise Complete Breakdown</h3>
                            <div class="table-controls">
                                <span id="sectorsCount" class="data-count">Loading...</span>
                                <button id="exportSectorsData" class="btn btn--outline btn--sm">Export Sectors XLSX</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table id="sectorsTable" class="data-table">
                                <thead>
                                    <tr>
                                        <th data-sort="sector">Development Sector</th>
                                        <th data-sort="spending">Total Spending (‚Çπ Cr)</th>
                                        <th data-sort="projects">Number of Projects</th>
                                        <th data-sort="companies">Companies Involved</th>
                                        <th data-sort="percentage">% of Total</th>
                                    </tr>
                                </thead>
                                <tbody id="sectorsTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Companies Tab -->
                <div id="companies" class="tab-content">
                <!--
                    <div class="data-header">
                        <h2>All Companies Analysis - Complete Dataset</h2>
                        <p class="data-description">Search, filter, and analyze all companies in the CSR database</p>
                    </div>
                -->    
                    <div class="section-grid">
                        <div class="chart-section full-width">
                            <div class="chart-header">
                               <!-- <h3>Top 20 Companies by CSR Spending</h3> -->
                                <button class="chart-download-btn" data-chart="companies">üì• Download PNG</button>
                            </div>
                            <div class="chart-container" style="position: relative; height: 400px;">
                                <canvas id="companiesChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-section">
                        <div class="table-header">
                            <h3>Company Rankings & Data</h3>
                            <div class="table-controls">
                                <span id="companyCount" class="data-count">Loading...</span>
                                <div class="pagination-controls">
                                    <button id="prevPage" class="btn btn--sm">Previous</button>
                                    <span id="pageInfo">Page 1</span>
                                    <button id="nextPage" class="btn btn--sm">Next</button>
                                    <button id="exportCompaniesData" class="btn btn--outline btn--sm">Export Companies XLSX</button>
                                </div>
                            </div>
                        </div>
                        <div class="table-container">
                            <table id="companiesTable" class="data-table">
                                <thead>
                                    <tr>
                                        <th data-sort="rank">Rank</th>
                                        <th data-sort="company">Company Name</th>
                                        <th data-sort="psu">PSU Type</th>
                                        <th data-sort="state">State</th>
                                        <th data-sort="sector">Sector</th>
                                        <th data-sort="spending">Total Spending (‚Çπ Cr)</th>
                                        <th data-sort="projects">Projects</th>
                                    </tr>
                                </thead>
                                <tbody id="companiesTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <!-- Load the revised app script -->
    <script src="app.js"></script>
    <div id="company-list"></div>
    <div id="pagination-controls"></div>

</body>
</html>
