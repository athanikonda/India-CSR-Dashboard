<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>India CSR Spending Dashboard</title>
    <link rel="stylesheet" href="/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script src="/app.js"></script>
</head>
<body>
    <div class="container mx-auto p-4 max-w-container-xl">
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-center text-text">India CSR Spending Dashboard</h1>
            <p class="text-xl text-center text-text-secondary mt-2">FY 2023-24</p>
            <div class="filter-status mt-4 text-center" id="state-count">Loading...</div>
            <div class="filter-status mt-2 text-center" id="filterSummary">Loading...</div>
        </header>

        <div class="tabs mb-8">
            <div class="flex flex-wrap gap-2 border-b border-border">
                <button class="tab-button px-4 py-2 text-md font-medium text-text-secondary hover:text-primary border-b-2 border-transparent hover:border-primary active" data-tab="overview">Overview</button>
                <button class="tab-button px-4 py-2 text-md font-medium text-text-secondary hover:text-primary border-b-2 border-transparent hover:border-primary" data-tab="indiaMapTab">India Map</button>
                <button class="tab-button px-4 py-2 text-md font-medium text-text-secondary hover:text-primary border-b-2 border-transparent hover:border-primary" data-tab="stateAnalysis">State Analysis</button>
                <button class="tab-button px-4 py-2 text-md font-medium text-text-secondary hover:text-primary border-b-2 border-transparent hover:border-primary" data-tab="sectorAnalysis">Sector Analysis</button>
                <button class="tab-button px-4 py-2 text-md font-medium text-text-secondary hover:text-primary border-b-2 border-transparent hover:border-primary" data-tab="companies">Companies</button>
            </div>
        </div>

        <div class="filters mb-8 flex flex-wrap gap-4">
            <div class="filter-group flex-1 min-w-[200px]">
                <label for="stateFilter" class="block text-sm font-medium text-text mb-1">States (Multi-select)</label>
                <select id="stateFilter" multiple class="w-full p-2 border border-border rounded-radius-md bg-surface text-text focus:outline-none focus:ring focus:ring-focus-ring">
                    <option value="__ALL__">Loading states...</option>
                </select>
            </div>
            <div class="filter-group flex-1 min-w-[200px]">
                <label for="sectorFilter" class="block text-sm font-medium text-text mb-1">Sectors (Multi-select)</label>
                <select id="sectorFilter" multiple class="w-full p-2 border border-border rounded-radius-md bg-surface text-text focus:outline-none focus:ring focus:ring-focus-ring">
                    <option value="__ALL__">Loading sectors...</option>
                </select>
            </div>
            <div class="filter-group flex-1 min-w-[200px]">
                <label for="psuFilter" class="block text-sm font-medium text-text mb-1">PSU Type (Multi-select)</label>
                <select id="psuFilter" multiple class="w-full p-2 border border-border rounded-radius-md bg-surface text-text focus:outline-none focus:ring focus:ring-focus-ring">
                    <option value="PSU">PSU</option>
                    <option value="Non-PSU">Non-PSU</option>
                </select>
            </div>
            <div class="filter-group flex-1 min-w-[200px]">
                <label for="companySearch" class="block text-sm font-medium text-text mb-1">Company Search label>
                <input id="companySearch" type="text" class="w-full p-2 border border-border rounded-radius-md bg-surface text-text focus:outline-none focus:ring focus:ring-focus-ring" placeholder="Enter company name..." />
            </div>
            <div class="filter-group flex items-end">
                <button id="resetFilters" class="px-4 py-2 bg-primary text-btn-primary-text rounded-radius-md hover:bg-primary-hover active:bg-primary-active focus:outline-none focus:ring focus:ring-focus-ring">Reset Filters</button>
                <button id="exportFiltered" class="ml-2 px-4 py-2 bg-primary text-btn-primary-text rounded-radius-md hover:bg-primary-hover active:bg-primary-active focus:outline-none focus:ring focus:ring-focus-ring">Export Filtered XLSX</button>
            </div>
        </div>

        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p>Loading complete CSR dataset from Google Sheets...</p>
            </div>
        </div>

        <div class="tab-content active" id="overview">
            <div class="dataset-stats grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="stat-badge">
                    <span class="text-2xl">‚Çπ</span>
                    <span id="totalSpending" class="text-2xl font-semibold number">Loading...</span>
                    <p class="text-sm text-text-secondary mt-1">Total CSR Spending</p>
                </div>
                <div class="stat-badge">
                    <span class="text-2xl">üè¢</span>
                    <span id="totalCompanies" class="text-2xl font-semibold number">Loading...</span>
                    <p class="text-sm text-text-secondary mt-1">Total Companies</p>
                    <p class="text-xs text-text-secondary">From complete dataset</p>
                </div>
                <div class="stat-badge">
                    <span class="text-2xl">üìã</span>
                    <span id="totalProjects" class="text-2xl font-semibold number">Loading...</span>
                    <p class="text-sm text-text-secondary mt-1">Total Projects</p>
                </div>
                <div class="stat-badge">
                    <span class="text-2xl">üìä</span>
                    <span id="avgPerProject" class="text-2xl font-semibold number">Loading...</span>
                    <p class="text-sm text-text-secondary mt-1">Average per Project</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="chart-section bg-surface p-6 rounded-radius-md border border-card-border">
                    <div class="chart-header flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-text">CSR Spending Rankings: Top 15 States/UTs (Curated List)</h3>
                        <button class="chart-download-btn" data-chart="overviewStatesChart">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            Download PNG
                        </button>
                    </div>
                    <div class="chart-container relative" style="height: 300px;">
                        <canvas id="overviewStatesChart"></canvas>
                    </div>
                </div>
                <div class="chartANN section bg-surface p-6 rounded-radius-md border border-card-border">
                    <div class="chart-header flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-text">CSR Spending Rankings: Top 10 Development Sectors (Curated List)</h3>
                        <button class="chart-download-btn" data-chart="overviewSectorsChart">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h103 0 003-3v-1m-4-4l-4 Ironically, 4 4m0 0l-4-4m4 4V4"></path></svg>
                            Download PNG
                        </button>
                    </div>
                    <div class="chart-container relative" style="height: 300px;">
                        <canvas id="overviewSectorsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="indiaMapTab">
            <div class="chart-section bg-surface p-6 rounded-radius-md border border-card-border">
                <div class="chart-header flex justify-between items-center mb-4">
                    <div>
                        <h3 class="text-lg font-semibold text-text">CSR Spending by States/UTs (Curated List)</h3>
                        <p class="text-sm text-text-secondary">India CSR Spending Dashboard | FY 2023-24</p>
                    </div>
                    <button class="chart-download-btn" id="exportMap">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Download PNG
                    </button>
                </div>
                <div class="map-container relative">
                    <div id="indiaMap"></div>
                    <div id="mapTooltip" class="map-tooltip">
                        <div class="tooltip-content">
                            <p><strong id="tooltipState">State</strong></p>
                            <p>Spending: <span id="tooltipSpending">‚Çπ0 Cr</span></p>
                            <p>Projects: <span id="tooltipProjects">0</span></p>
                            <p>Companies: <span id="tooltipCompanies">0</span></p>
                        </div>
                    </div>
                    <div class="filter-status mt-4 text-center" id="mapFilterSummary">No filters applied</div>
                    <div class="chart-watermark">Prepared by Ashok Thanikonda</div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="stateAnalysis">
            <div class="chart-section bg-surface p-6 rounded-radius-md border border-card-border">
                <div class="chart-header flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-text">CSR Spending in States/UTs (Curated List)</h3>
                    <button class="chart-download-btn" data-chart="statesChart">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Download PNG
                    </button>
                </div>
                <div class="chart-container relative" style="height: 400px;">
                    <canvas id="statesChart"></canvas>
                </div>
            </div>
            <div class="table-section bg-surface p-6 rounded-radius-md border border-card-border mt-4">
                <div class="table-header flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-text">Loading...</h3>
                    <button id="exportStates" class="chart-download-btn">
                        Export States XLSX
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="data-table w-full text-left text-sm text-text">
                        <thead class="bg-secondary">
                            <tr>
                                <th class="p-3">State/Region</th>
                                <th class="p-3 text-right">Total Spending (‚Çπ Cr)</th>
                                <th class="p-3 text-right">Number of Projects</th>
                                <th class="p-3 text-right">Number of Companies</th>
                                <th class="p-3 text-right">Avg per Project (‚Çπ Cr)</th>
                                <th class="p-3 text-right">% of Total</th>
                            </tr>
                        </thead>
                        <tbody id="statesTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-content" id="sectorAnalysis">
            <div class="chart-section bg-surface p-6 rounded-radius-md border border-card-border">
                <div class="chart-header flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-text">CSR Spending in Development Sectors (Curated List)</h3>
                    <button class="chart-download-btn" data-chart="sectorsChart">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Download PNG
                    </button>
                </div>
                <div class="chart-container relative" style="height: 400px;">
                    <canvas id="sectorsChart"></canvas>
                </div>
            </div>
            <div class="table-section bg-surface p-6 rounded-radius-md border border-card-border mt-4">
                <div class="table-header flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-text">Sector-wise Complete Breakdown</h3>
                    <button id="exportSectors" class="chart-download-btn">
                        Export Sectors XLSX
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="data-table w-full text-left text-sm text-text">
                        <thead class="bg-secondary">
                            <tr>
                                <th class="p-3">Development Sector</th>
                                <th class="p-3 text-right">Total Spending (‚Çπ Cr)</th>
                                <th class="p-3 text-right">Number of Projects</th>
                                <th class="p-3 text-right">Companies Involved</th>
                                <th class="p-3 text-right">% of Total</th>
                            </tr>
                        </thead>
                        <tbody id="sectorsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-content" id="companies">
            <div class="chart-section bg-surface p-6 rounded-radius-md border border-card-border">
                <div class="chart-header flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-text">CSR Spending Rankings: Top 20 Companies (Curated List)</h3>
                    <button class="chart-download-btn" data-chart="companiesChart">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Download PNG
                    </button>
                </div>
                <div class="chart-container relative" style="height: 400px;">
                    <canvas id="companiesChart"></canvas>
                </div>
            </div>
            <div class="table-section bg-surface p-6 rounded-radius-md border border-card-border mt-4">
                <div class="table-header flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-text">Company Rankings & Data</h3>
                    <div class="flex gap-2">
                        <button id="prevPage" class="px-4 py-2 bg-primary text-btn-primary-text rounded-radius-md hover:bg-primary-hover active:bg-primary-active focus:outline-none focus:ring focus:ring-focus-ring">Previous</button>
                        <span id="pageInfo" class="px-4 py-2 text-sm text-text-secondary">Page 1</span>
                        <button id="nextPage" class="px-4 py-2 bg-primary text-btn-primary-text rounded-radius-md hover:bg-primary-hover active:bg-primary-active focus:outline-none focus:ring focus:ring-focus-ring">Next</button>
                        <button id="exportCompanies" class="chart-download-btn">
                            Export Companies XLSX
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="data-table w-full text-left text-sm text-text">
                        <thead class="bg-secondary">
                            <tr>
                                <th class="p-3">Rank</th>
                                <th class="p-3">Company Name</th>
                                <th class="p-3">PSU Type</th>
                                <th class="p-3">State</th>
                                <th class="p-3">Sector</th>
                                <th class="p-3 text-right">Total Spending (‚Çπ Cr)</th>
                                <th class="p-3 text-right">Projects</th>
                            </tr>
                        </thead>
                        <tbody id="companiesTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
