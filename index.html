<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSR Spending Dashboard - FY 2023-24 (Complete Dataset)</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div id="mainDashboard" class="dashboard-container" style="display: none;">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="container">
                <h1>Corporate Social Responsibility Dashboard</h1>
                <p class="subtitle">FY 2023-24 ‚Ä¢ Complete Live Dataset</p>
                <div class="dataset-stats">
                    <span class="stat-badge" id="totalCompaniesHeader">Loading...</span>
                    <span class="stat-badge" id="totalStatesHeader">43 States</span>
                    <span class="stat-badge" id="totalProjectsHeader">Loading...</span>
                    <span class="stat-badge" id="totalSpendingHeader">Loading...</span>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="dashboard-nav">
            <div class="container">
                <div class="nav-tabs">
                    <button class="tab-button active" data-tab="overview">Overview</button>
                    <button class="tab-button" data-tab="map">India Map</button>
                    <button class="tab-button" data-tab="states">State Analysis</button>
                    <button class="tab-button" data-tab="sectors">Sector Analysis</button>
                    <button class="tab-button" data-tab="companies">Companies</button>
                </div>
            </div>
        </nav>

        <!-- Filters Panel -->
        <div class="filters-panel">
            <div class="container">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="form-label">States (Multi-select)</label>
                        <select id="stateFilter" class="form-control" multiple size="3">
                            <option value="">Loading states...</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label">Sectors (Multi-select)</label>
                        <select id="sectorFilter" class="form-control" multiple size="3">
                            <option value="">Loading sectors...</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label">PSU Type (Multi-select)</label>
                        <select id="psuFilter" class="form-control" multiple size="3">
                            <option value="PSU">PSU</option>
                            <option value="Non-PSU">Non-PSU</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label">Company Search</label>
                        <input type="text" id="companySearch" class="form-control" placeholder="Search companies...">
                    </div>
                    <div class="filter-actions">
                        <button id="resetFilters" class="btn btn--secondary">Reset Filters</button>
                        <button id="exportFilteredData" class="btn btn--primary">Export Filtered XLSX</button>
                    </div>
                </div>
                <div class="filter-results">
                    <span id="filterResults" class="filter-status">Loading complete dataset...</span>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading-overlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p>Loading complete CSR dataset from Google Sheets...</p>
            </div>
        </div>

        <!-- Main Content -->
        <main class="dashboard-main">
            <div class="container">
                
                <!-- Overview Tab -->
                <div id="overview" class="tab-content active">
                    <!-- Key Metrics Cards -->
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-icon">‚Çπ</div>
                            <div class="metric-content">
                                <h3 class="metric-value" id="totalSpendingMetric">Loading...</h3>
                                <p class="metric-label">Total CSR Spending</p>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">üè¢</div>
                            <div class="metric-content">
                                <h3 class="metric-value" id="totalCompaniesMetric">Loading...</h3>
                                <p class="metric-label">Total Companies</p>
                                <small>From complete dataset</small>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">üìã</div>
                            <div class="metric-content">
                                <h3 class="metric-value" id="totalProjectsMetric">Loading...</h3>
                                <p class="metric-label">Total Projects</p>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">üìä</div>
                            <div class="metric-content">
                                <h3 class="metric-value" id="avgPerProjectMetric">Loading...</h3>
                                <p class="metric-label">Average per Project</p>
                            </div>
                        </div>
                    </div>

                    <!-- Company Distribution Analysis -->
                    <div class="section-grid">
                        <div class="chart-section">
                            <div class="chart-header">
                                <h3>Top 15 States by CSR Spending</h3>
                                <button class="chart-download-btn" data-chart="overviewStates">üì• Download PNG</button>
                            </div>
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="overviewStatesChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-section">
                            <div class="chart-header">
                                <h3>Top Development Sectors</h3>
                                <button class="chart-download-btn" data-chart="overviewSectors">üì• Download PNG</button>
                            </div>
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="overviewSectorsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- India Map Tab -->
                <div id="map" class="tab-content">
                    <div class="data-header">
                        <h2>India CSR Spending Map</h2>
                        <p class="data-description">Interactive map showing CSR spending by state with complete dataset</p>
                    </div>
                    
                    <div class="map-section">
                        <div class="map-container">
                            <svg id="indiaMap" viewBox="0 0 1000 800">
                                <!-- India states will be loaded here -->
                                <g id="statesGroup">
                                    <!-- Simplified India state paths -->
                                    <path id="maharashtra" d="M300,400 L400,400 L400,500 L300,500 Z" class="state-path" data-state="Maharashtra" data-spending="0" data-projects="0"/>
                                    <path id="gujarat" d="M200,350 L300,350 L300,450 L200,450 Z" class="state-path" data-state="Gujarat" data-spending="0" data-projects="0"/>
                                    <path id="karnataka" d="M300,500 L400,500 L400,600 L300,600 Z" class="state-path" data-state="Karnataka" data-spending="0" data-projects="0"/>
                                    <path id="tamilnadu" d="M350,600 L450,600 L450,700 L350,700 Z" class="state-path" data-state="Tamil Nadu" data-spending="0" data-projects="0"/>
                                    <path id="delhi" d="M400,250 L450,250 L450,300 L400,300 Z" class="state-path" data-state="Delhi" data-spending="0" data-projects="0"/>
                                    <path id="uttarpradesh" d="M450,250 L550,250 L550,350 L450,350 Z" class="state-path" data-state="Uttar Pradesh" data-spending="0" data-projects="0"/>
                                    <path id="odisha" d="M550,400 L650,400 L650,500 L550,500 Z" class="state-path" data-state="Odisha" data-spending="0" data-projects="0"/>
                                    <path id="rajasthan" d="M300,250 L400,250 L400,350 L300,350 Z" class="state-path" data-state="Rajasthan" data-spending="0" data-projects="0"/>
                                    <path id="andhrapradesh" d="M450,500 L550,500 L550,600 L450,600 Z" class="state-path" data-state="Andhra Pradesh" data-spending="0" data-projects="0"/>
                                    <path id="westbengal" d="M600,350 L700,350 L700,450 L600,450 Z" class="state-path" data-state="West Bengal" data-spending="0" data-projects="0"/>
                                    <path id="telangana" d="M450,450 L550,450 L550,500 L450,450 Z" class="state-path" data-state="Telangana" data-spending="0" data-projects="0"/>
                                    <path id="haryana" d="M400,200 L450,200 L450,250 L400,250 Z" class="state-path" data-state="Haryana" data-spending="0" data-projects="0"/>
                                    <path id="madhyapradesh" d="M400,350 L550,350 L550,450 L400,450 Z" class="state-path" data-state="Madhya Pradesh" data-spending="0" data-projects="0"/>
                                    <path id="bihar" d="M550,300 L650,300 L650,400 L550,400 Z" class="state-path" data-state="Bihar" data-spending="0" data-projects="0"/>
                                    <path id="kerala" d="M300,650 L350,650 L350,720 L300,720 Z" class="state-path" data-state="Kerala" data-spending="0" data-projects="0"/>
                                </g>
                                
                                <!-- Legend -->
                                <g id="mapLegend" transform="translate(50, 650)">
                                    <text x="0" y="20" class="legend-title">CSR Spending (‚Çπ Cr)</text>
                                    <rect x="0" y="30" width="20" height="15" fill="#fff2f0" stroke="#ccc"/>
                                    <text x="25" y="42" class="legend-text">0-500</text>
                                    <rect x="80" y="30" width="20" height="15" fill="#ffccc7" stroke="#ccc"/>
                                    <text x="105" y="42" class="legend-text">500-1000</text>
                                    <rect x="180" y="30" width="20" height="15" fill="#ff7875" stroke="#ccc"/>
                                    <text x="205" y="42" class="legend-text">1000-2000</text>
                                    <rect x="280" y="30" width="20" height="15" fill="#f5222d" stroke="#ccc"/>
                                    <text x="305" y="42" class="legend-text">2000+</text>
                                </g>
                            </svg>
                            
                            <!-- Map tooltip -->
                            <div id="mapTooltip" class="map-tooltip">
                                <div class="tooltip-content">
                                    <strong id="tooltipState">State</strong><br>
                                    <span id="tooltipSpending">Spending: ‚Çπ0 Cr</span><br>
                                    <span id="tooltipProjects">Projects: 0</span><br>
                                    <span id="tooltipCompanies">Companies: 0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- States Tab -->
                <div id="states" class="tab-content">
                    <div class="data-header">
                        <h2>Complete State Analysis - All States</h2>
                        <p class="data-description">Comprehensive analysis of CSR spending across all states from complete dataset</p>
                    </div>
                    
                    <div class="section-grid">
                        <div class="chart-section full-width">
                            <div class="chart-header">
                                <h3>All States by CSR Spending</h3>
                                <button class="chart-download-btn" data-chart="states">üì• Download PNG</button>
                            </div>
                            <div class="chart-container" style="position: relative; height: 400px;">
                                <canvas id="statesChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-section">
                        <div class="table-header">
                            <h3>All States - Complete Data</h3>
                            <div class="table-controls">
                                <span id="statesCount" class="data-count">Loading...</span>
                                <button id="exportStatesData" class="btn btn--outline btn--sm">Export States XLSX</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table id="statesTable" class="data-table">
                                <thead>
                                    <tr>
                                        <th data-sort="state">State/Region</th>
                                        <th data-sort="spending">Total Spending (‚Çπ Cr)</th>
                                        <th data-sort="projects">Number of Projects</th>
                                        <th data-sort="companies">Number of Companies</th>
                                        <th data-sort="average">Avg per Project (‚Çπ Cr)</th>
                                        <th data-sort="percentage">% of Total</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sectors Tab -->
                <div id="sectors" class="tab-content">
                    <div class="data-header">
                        <h2>Development Sectors Analysis</h2>
                        <p class="data-description">Complete breakdown of CSR investments across all development sectors</p>
                    </div>
                    
                    <div class="section-grid">
                        <div class="chart-section full-width">
                            <div class="chart-header">
                                <h3>All Development Sectors</h3>
                                <button class="chart-download-btn" data-chart="sectors">üì• Download PNG</button>
                            </div>
                            <div class="chart-container" style="position: relative; height: 400px;">
                                <canvas id="sectorsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-section">
                        <div class="table-header">
                            <h3>Sector-wise Complete Breakdown</h3>
                            <div class="table-controls">
                                <span id="sectorsCount" class="data-count">Loading...</span>
                                <button id="exportSectorsData" class="btn btn--outline btn--sm">Export Sectors XLSX</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table id="sectorsTable" class="data-table">
                                <thead>
                                    <tr>
                                        <th data-sort="sector">Development Sector</th>
                                        <th data-sort="spending">Total Spending (‚Çπ Cr)</th>
                                        <th data-sort="projects">Number of Projects</th>
                                        <th data-sort="companies">Companies Involved</th>
                                        <th data-sort="percentage">% of Total</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Companies Tab -->
                <div id="companies" class="tab-content">
                    <div class="data-header">
                        <h2>All Companies Analysis - Complete Dataset</h2>
                        <p class="data-description">Search, filter, and analyze all companies in the CSR database</p>
                    </div>
                    
                    <div class="section-grid">
                        <div class="chart-section full-width">
                            <div class="chart-header">
                                <h3>Top 20 Companies by CSR Spending</h3>
                                <button class="chart-download-btn" data-chart="companies">üì• Download PNG</button>
                            </div>
                            <div class="chart-container" style="position: relative; height: 400px;">
                                <canvas id="companiesChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-section">
                        <div class="table-header">
                            <h3>Company Rankings & Data</h3>
                            <div class="table-controls">
                                <span id="companyCount" class="data-count">Loading...</span>
                                <div class="pagination-controls">
                                    <button id="prevPage" class="btn btn--sm">Previous</button>
                                    <span id="pageInfo">Page 1</span>
                                    <button id="nextPage" class="btn btn--sm">Next</button>
                                    <button id="exportCompaniesData" class="btn btn--outline btn--sm">Export Companies XLSX</button>
                                </div>
                            </div>
                        </div>
                        <div class="table-container">
                            <table id="companiesTable" class="data-table">
                                <thead>
                                    <tr>
                                        <th data-sort="rank">Rank</th>
                                        <th data-sort="company">Company Name</th>
                                        <th data-sort="psu">PSU Type</th>
                                        <th data-sort="state">State</th>
                                        <th data-sort="sector">Sector</th>
                                        <th data-sort="spending">Total Spending (‚Çπ Cr)</th>
                                        <th data-sort="projects">Projects</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="app.js"></script>
<div id="company-list"></div>
<div id="pagination-controls"></div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const loading = document.getElementById("loadingIndicator");
        if (loading) loading.style.display = "none";

        const dashboard = document.getElementById("mainDashboard");
        if (dashboard) dashboard.style.display = "block";
    });
</script>

</body>
</html>
